<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>梦的博客 - 须臾永恒</title><meta name="keywords" content="renmcc ren_mcc"><meta name="author" content="ren_mcc"><meta name="copyright" content="ren_mcc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一个收藏回忆与分享技术的地方！">
<meta property="og:type" content="website">
<meta property="og:title" content="梦的博客">
<meta property="og:url" content="https://renm.cc/page/11/index.html">
<meta property="og:site_name" content="梦的博客">
<meta property="og:description" content="一个收藏回忆与分享技术的地方！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://renm.cc/img/avatar2.webp">
<meta property="article:author" content="ren_mcc">
<meta property="article:tag" content="renmcc ren_mcc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://renm.cc/img/avatar2.webp"><link rel="shortcut icon" href="/img/EPm3X74Wvr.png"><link rel="canonical" href="https://renm.cc/page/11/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":2000},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '梦的博客',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-03-28 19:00:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/twikoo-beautify.css"  media="defer" onload="this.media='all'"><script src="/live2d-widget/autoload.js"></script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="/js/function.min.css"><script src="/js/jquery.min.js"></script><script src="/js/custom.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script async src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar2.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">117</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">梦的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">梦的博客</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/20220119/docker-20220119-docker%E5%AE%89%E8%A3%85%E5%92%8C%E5%8A%A0%E9%80%9F/" title="docker安装和加速"><img class="post_bg" src="/img/yuanshen/avatar/91529822720e0cf3e8983ca08778df16bf09aac1.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker安装和加速"></a></div><div class="recent-post-info"><a class="article-title" href="/20220119/docker-20220119-docker%E5%AE%89%E8%A3%85%E5%92%8C%E5%8A%A0%E9%80%9F/" title="docker安装和加速">docker安装和加速</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-19T15:16:53.000Z" title="发表于 2022-01-19 23:16:53">2022-01-19</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker/">docker</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker/">docker</a></span></div><div class="content">安装
Centos7
1234567891011121314151617181920212223242526# step 1: 安装必要的一些系统工具sudo yum install -y yum-utils device-mapper-persistent-data lvm2# Step 2: 添加软件源信息sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# Step 3: 更新并安装Docker-CEsudo yum makecache fastsudo yum -y install docker-ce# Step 4: 开启Docker服务sudo service docker start# 注意：# 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，您可以通过以下方式开启。同理可以开启各种测试版本等。# vim /etc/yum.repos.d/docker- ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220111/kvm-20220111-4-%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C-%E7%83%AD%E6%B7%BB%E5%8A%A0%E4%B8%8E%E7%83%AD%E8%BF%81%E7%A7%BB/" title="4-桥接网络-热添加与热迁移"><img class="post_bg" src="/img/yuanshen/avatar/8812956h7p1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4-桥接网络-热添加与热迁移"></a></div><div class="recent-post-info"><a class="article-title" href="/20220111/kvm-20220111-4-%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C-%E7%83%AD%E6%B7%BB%E5%8A%A0%E4%B8%8E%E7%83%AD%E8%BF%81%E7%A7%BB/" title="4-桥接网络-热添加与热迁移">4-桥接网络-热添加与热迁移</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T15:43:28.000Z" title="发表于 2022-01-11 23:43:28">2022-01-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-12T12:14:50.000Z" title="更新于 2022-02-12 20:14:50">2022-02-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kvm/">kvm</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kvm/">kvm</a></span></div><div class="content">一 桥接网络
1：创建桥接网络
1virsh iface-bridge eth0 br0
2：基于桥接网络创建虚拟机
1234567891011virt-install --virt-type kvm \--os-type=linux \--os-variant rhel7 \--name web04 \--memory 1024 \--vcpus 1 \--disk /opt/web04.qcow2,format=qcow2,size=10 \--boot hd \--network bridge=br0 \--graphics vnc,listen=0.0.0.0 \--noautoconsole
3：将已有的虚机修改为桥接网络


virsh edit web02
#修改以下位置


&lt;source bridge='br0’/&gt;


修改虚拟机ip地址


1vim /etc/sysconfig/network-scripts/ifcfg-eth0
然后通过vnc配置好虚拟机的IP地址,即可用其他机器通过ssh进行连接了
二 热添加技术
热添加技术就是不停机的情况下， ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220111/kvm-20220111-3-%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F-%E5%BF%AB%E7%85%A7%E5%92%8C%E5%85%8B%E9%9A%86/" title="3-磁盘格式-快照和克隆"><img class="post_bg" src="/img/yuanshen/avatar/128763_7576398147.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3-磁盘格式-快照和克隆"></a></div><div class="recent-post-info"><a class="article-title" href="/20220111/kvm-20220111-3-%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F-%E5%BF%AB%E7%85%A7%E5%92%8C%E5%85%8B%E9%9A%86/" title="3-磁盘格式-快照和克隆">3-磁盘格式-快照和克隆</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T15:35:24.000Z" title="发表于 2022-01-11 23:35:24">2022-01-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-12T12:14:50.000Z" title="更新于 2022-02-12 20:14:50">2022-02-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kvm/">kvm</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kvm/">kvm</a></span></div><div class="content">一 KVM磁盘格式
1.两种磁盘格式

raw：
裸格式，占用空间比较大，不适合远程传输,不支持快照功能，性能较好
qcow2：
cow(copy on write)占用空间小，适合传输，支持快照，性能比raw差一点点

2.磁盘相关命令

创建相应格式磁盘

12qemu-img create          test.raw   1Gqemu-img create -f qcow2 test.qcow2 1G

查看虚拟磁盘信息

1qemu-img info test.raw

调整虚拟磁盘容量大小

1qemu-img resize test.raw +1G

磁盘格式转换
会多出一份新格式文件,源文件保留

12345qemu-img convert -f raw -O qcow2  test.raw test2.qcow2[root@noah-tp opt]# ll test* -h-rw-r--r--. 1 root root 193K Nov 14 22:45 test2.qcow2-rw-r--r--. 1 root root 193K Nov 14 22:42 t ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220111/kvm-20220111-2-KVM%E6%97%A5%E5%B8%B8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4/" title="2-KVM日常管理命令"><img class="post_bg" src="/img/yuanshen/avatar/10009.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2-KVM日常管理命令"></a></div><div class="recent-post-info"><a class="article-title" href="/20220111/kvm-20220111-2-KVM%E6%97%A5%E5%B8%B8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4/" title="2-KVM日常管理命令">2-KVM日常管理命令</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T15:27:23.000Z" title="发表于 2022-01-11 23:27:23">2022-01-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-12T12:14:50.000Z" title="更新于 2022-02-12 20:14:50">2022-02-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kvm/">kvm</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kvm/">kvm</a></span></div><div class="content">开关机与查看

列表显示
virsh list 只会显示运行中的列表
virsh list --all 显示所有虚拟机列表
开机start
virsh start centos7-mb
关机shutdown
virsh shutdown centos7-mb
强制关机destroy
virsh destroy centos7-mb
查询vnc端口号vncdisplay
virsh vncdisplay centos7-mb

配置管理


存放位置
kvm创建的虚拟机,配置文件存放在目录/etc/libvirt/qemu/中,配置文件以虚拟机+.xml结尾,如:/etc/libvirt/qemu/ centos7-mb.xml


修改配置 edit
virsh edit centos7-mb


导出配置 dumpxml
virsh dumpxml centos7-mb &gt;/opt/centos7-mb.xml


删除镜像/配置 undefine
virsh undefine centos7-mb



如果要删除虚拟机,建议先关机[shutdown或destroy]，再删除 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220111/kvm-20220111-1-KVM%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2/" title="1-KVM基础与快速部署"><img class="post_bg" src="/img/yuanshen/avatar/2fdda3cc7cd98d1095211fc9b20195077aec901c.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1-KVM基础与快速部署"></a></div><div class="recent-post-info"><a class="article-title" href="/20220111/kvm-20220111-1-KVM%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2/" title="1-KVM基础与快速部署">1-KVM基础与快速部署</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T15:12:57.000Z" title="发表于 2022-01-11 23:12:57">2022-01-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-12T12:14:50.000Z" title="更新于 2022-02-12 20:14:50">2022-02-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kvm/">kvm</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kvm/">kvm</a></span></div><div class="content">一 虚拟化基础


什么是虚拟化
虚拟化就是通过模拟计算机硬件(cpu,内存，硬盘，网卡)来实现在一台物理服务器上运行同时多个不同的操作系统，并且使每个操作系统之间都是互相隔离的


什么是kvm虚拟化
目前国内的公有云底层采用的都是kvm虚拟化，经过这几年的快速发展，kvm计算已经非常成熟稳定，在任何linux发行版中，kvm都是标配，虚拟化已经成为了一项必备的技能


二 环境准备

主机规划




主机名
IP地址
操作系统
内存
硬盘




kvm01
10.0.0.11
centos7.4
4G
50G





上传模板并克隆
根据以前的标准模板克隆主机,克隆后按规划设置主机名,IP地址,并关闭selinux和firewalld


在window上安装TightVNC
tightvnc官网：http://www.tightvnc.com
vnc是一个跨平台的远程桌面软件，待会安装kvm虚拟机系统的时候使用


确定服务器支持虚拟化


12[root@kvm01 ~]# cat /proc/cpuinfo | egrep -o &#x27;vmx|svm&#x27;v ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220111/docker-compose-20220111-5-%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8%E5%92%8C%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/" title="5-命令补全和资源限制"><img class="post_bg" src="/img/yuanshen/avatar/100012.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="5-命令补全和资源限制"></a></div><div class="recent-post-info"><a class="article-title" href="/20220111/docker-compose-20220111-5-%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8%E5%92%8C%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/" title="5-命令补全和资源限制">5-命令补全和资源限制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T15:06:27.000Z" title="发表于 2022-01-11 23:06:27">2022-01-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">1 命令补全
123curl -L -o /etc/bash_completion.d/docker-compose \    https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose # 下次登陆生效
2 资源限制
docker-compose v3版本命令,可以使用deploy来做资源限制,如:
12345image: flink:1.3.1deploy:  resources:    limits:      memory: 1G
但是docker-compose up命令不支持资源限制参数,提示如下:
1....Compose does not support &#x27;deploy&#x27; configuration - use `docker stack deploy` to deploy to a swarm
这个时候可以使用--compatibility参数
1--compatib ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220110/docker-compose-20220110-4-compose-stack-swarm%E9%9B%86%E7%BE%A4/" title="4-compose/stack/swarm集群"><img class="post_bg" src="/img/yuanshen/avatar/9183h1124p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4-compose/stack/swarm集群"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-4-compose-stack-swarm%E9%9B%86%E7%BE%A4/" title="4-compose/stack/swarm集群">4-compose/stack/swarm集群</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T11:56:19.000Z" title="发表于 2022-01-10 19:56:19">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">区别和联系
docker-compose V3之后,设置资源限额和容器数量的配置,只能写在deploy字段里, 但是docker-compose up  却不支持 deploy 配置
编辑同一份docker-compose.yml, 但是compose 和 swarm/stack的分工是这样的:

docker-compose   用于dev   支持build/restart  但是不支持deploy,
swarm/stack      用于 prod  支持 deply的各种设置,包括分配cpu和内存, 但是创建容器只支持从image,不支持build.

deploy扩缩容参数
deploy是用于在docker集群环境下自动进行扩容和缩容的配置项,docker-compose up and docker-compose run两个命令会忽略此配置,只有docker stack deploy命令下才有用
有以下子选项

endpoint_mode：集群对提供服务的方式

endpoint_mode: vip VIP方式
endpoint_mode: dnsrr dns轮询方式


 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220110/docker-compose-20220110-3-docker-compose%E5%91%BD%E4%BB%A4/" title="3-docker-compose命令"><img class="post_bg" src="/img/yuanshen/avatar/a519fa9bd68641ea9aa531c56b79170f!400x400.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3-docker-compose命令"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-3-docker-compose%E5%91%BD%E4%BB%A4/" title="3-docker-compose命令">3-docker-compose命令</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T09:18:48.000Z" title="发表于 2022-01-10 17:18:48">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">1，Docker-compose命令格式
    docker-compose [-f &lt;arg&gt;...] [options] [COMMAND] [ARGS...]

命令选项如下
12345-f --file FILE指定Compose模板文件，默认为docker-compose.yml-p --project-name NAME 指定项目名称，默认使用当前所在目录为项目名--verbose  输出更多调试信息-v，-version 打印版本并退出--log-level LEVEL 定义日志等级(DEBUG, INFO, WARNING, ERROR, CRITICAL)
2，docker-compose up
docker-compose up [options] [--scale SERVICE=NUM...] [SERVICE...]

选项包括：
12345678910-d 在后台运行服务容器-no-color 不是有颜色来区分不同的服务的控制输出-no-deps 不启动服务所链接的容器--force-recreate 强制重新创建容器，不能与-no-recre ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220110/docker-compose-20220110-2-compose%E5%91%BD%E4%BB%A4%E5%92%8Cyaml%E6%A8%A1%E6%9D%BF/" title="2-compose命令和yaml模板"><img class="post_bg" src="/img/yuanshen/avatar/10001.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2-compose命令和yaml模板"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-2-compose%E5%91%BD%E4%BB%A4%E5%92%8Cyaml%E6%A8%A1%E6%9D%BF/" title="2-compose命令和yaml模板">2-compose命令和yaml模板</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T09:00:18.000Z" title="发表于 2022-01-10 17:00:18">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">一 compose命令和模板说明
A. compse命令列表说明
每个命令后后还有很多参数,具体的请用--help去查看



命令名
参数说明




build
构建项目中的服务容器


images
列出所有镜像


kill
通过发送SIGKILL信号来强制停止服务容器


logs
查看服务器容器的输出


pause
暂停一个服务容器


port
打印某个容器的端口所映射的公共端口


ps
列出项目中目前的所有容器


pull
拉取服务依赖的镜像


push
推送服务依赖的镜像


restart
重启项目中的服务


rm
删除所有的服务器容器（停止状态的）


run
在指定服务上执行一个命令


scale
设置指定服务运行的容器个数


start
启动已经存在的服务容器


stop
停止已经处于运行状态的容器，但不删除它


top
展示运行的进程


unpause
恢复处于暂停状态中的服务


up
自动完成包括构建镜像、创建服务、启动服务并关联服务相关容器的一系列操作



B. Compose模板文件的说明

compose模板文件官方文档
co ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220110/docker-compose-20220110-1-docker-compose%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="1-docker-compose快速入门"><img class="post_bg" src="/img/yuanshen/avatar/10006.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1-docker-compose快速入门"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-1-docker-compose%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="1-docker-compose快速入门">1-docker-compose快速入门</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T03:19:56.000Z" title="发表于 2022-01-10 11:19:56">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">一 docker-compose的简介
docker-compose是dokcer官方的单机编排工具，让用户通过编写一个简单的模板文件，快速地创建和管理基于docker容器的应用集群。实现对docker容器集群的快速编排。
允许用户通过一个单独的docker-compose.yml模板文件（YAML格式）来定义一组相关联的应用容器作为一个项目（project）
A. Compose2个重要概念：

服务（service）
一个应用的容器，实际上可以包含若干运行相同镜像的容器实例。
项目（project）
由一组关联的应用容器组成的一个完整业务单元，在docker-compose.yml文件中定义。

B. 使用Compose的三步骤：

Dockerfile 定义应用的运行环境
docker-compose.yml 定义组成应用的各服务
docker-compose up 启动整个应用

C. docker-compose命令与模板文件

docker-compose命令
对于Compose来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或容器。默认针对项目

1234 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/10/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/#content-inner">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/#content-inner">12</a><a class="extend next" rel="next" href="/page/12/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar2.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ren_mcc</div><div class="author-info__description">一个收藏回忆与分享技术的地方！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">117</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/renmcc"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/20230328/vue-20230328-vue-router/" title="vue-router"><img src="/img/yuanshen/avatar/949456h38p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue-router"/></a><div class="content"><a class="title" href="/20230328/vue-20230328-vue-router/" title="vue-router">vue-router</a><time datetime="2023-03-28T09:19:57.000Z" title="发表于 2023-03-28 17:19:57">2023-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230328/vue-20230328-vue%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6%E6%8F%92%E6%A7%BD%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/" title="vue动态组件插槽以及自定义指令"><img src="/img/yuanshen/avatar/3b87e950352ac65ca2697d55e516d01892138a91.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue动态组件插槽以及自定义指令"/></a><div class="content"><a class="title" href="/20230328/vue-20230328-vue%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6%E6%8F%92%E6%A7%BD%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/" title="vue动态组件插槽以及自定义指令">vue动态组件插槽以及自定义指令</a><time datetime="2023-03-28T06:44:28.000Z" title="发表于 2023-03-28 14:44:28">2023-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230327/vue-20230327-vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB/" title="vue生命周期和数据共享"><img src="/img/yuanshen/avatar/20210501094041_fcc74.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue生命周期和数据共享"/></a><div class="content"><a class="title" href="/20230327/vue-20230327-vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB/" title="vue生命周期和数据共享">vue生命周期和数据共享</a><time datetime="2023-03-27T09:22:58.000Z" title="发表于 2023-03-27 17:22:58">2023-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230326/vue-20230326-vue%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" title="vue基础入门"><img src="/img/yuanshen/avatar/10007.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue基础入门"/></a><div class="content"><a class="title" href="/20230326/vue-20230326-vue%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" title="vue基础入门">vue基础入门</a><time datetime="2023-03-25T16:23:58.000Z" title="发表于 2023-03-26 00:23:58">2023-03-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230325/JavaScript-20230325-JavaScript%E5%9F%BA%E7%A1%80/" title="JavaScript基础"><img src="/img/yuanshen/avatar/10001.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaScript基础"/></a><div class="content"><a class="title" href="/20230325/JavaScript-20230325-JavaScript%E5%9F%BA%E7%A1%80/" title="JavaScript基础">JavaScript基础</a><time datetime="2023-03-25T08:36:32.000Z" title="发表于 2023-03-25 16:36:32">2023-03-25</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JavaScript/"><span class="card-category-list-name">JavaScript</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/containerd/"><span class="card-category-list-name">containerd</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/docker/"><span class="card-category-list-name">docker</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/docker-compose/"><span class="card-category-list-name">docker-compose</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/git/"><span class="card-category-list-name">git</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/golang/"><span class="card-category-list-name">golang</span><span class="card-category-list-count">38</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/istio/"><span class="card-category-list-name">istio</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kafka/"><span class="card-category-list-name">kafka</span><span class="card-category-list-count">2</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/containerd/" style="font-size: 1.32em; color: rgb(160, 174, 20)">containerd</a><a href="/tags/JavaScript/" style="font-size: 1.15em; color: rgb(99, 109, 55)">JavaScript</a><a href="/tags/docker-compose/" style="font-size: 1.28em; color: rgb(144, 189, 176)">docker-compose</a><a href="/tags/docker/" style="font-size: 1.38em; color: rgb(139, 177, 47)">docker</a><a href="/tags/git/" style="font-size: 1.15em; color: rgb(76, 194, 17)">git</a><a href="/tags/golang/" style="font-size: 1.45em; color: rgb(77, 184, 124)">golang</a><a href="/tags/istio/" style="font-size: 1.38em; color: rgb(128, 192, 141)">istio</a><a href="/tags/kubrnetes/" style="font-size: 1.35em; color: rgb(163, 6, 112)">kubrnetes</a><a href="/tags/kubernetes/" style="font-size: 1.42em; color: rgb(97, 14, 99)">kubernetes</a><a href="/tags/kafka/" style="font-size: 1.18em; color: rgb(186, 139, 190)">kafka</a><a href="/tags/kvm/" style="font-size: 1.25em; color: rgb(83, 178, 124)">kvm</a><a href="/tags/nginx/" style="font-size: 1.15em; color: rgb(127, 163, 136)">nginx</a><a href="/tags/python/" style="font-size: 1.22em; color: rgb(124, 14, 29)">python</a><a href="/tags/rancher/" style="font-size: 1.22em; color: rgb(159, 148, 130)">rancher</a><a href="/tags/redis/" style="font-size: 1.18em; color: rgb(8, 25, 123)">redis</a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.15em; color: rgb(191, 179, 0)">工具</a><a href="/tags/vue/" style="font-size: 1.25em; color: rgb(70, 56, 37)">vue</a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.22em; color: rgb(61, 153, 36)">大数据</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><span class="card-archive-list-count">25</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">十月 2022</span><span class="card-archive-list-count">11</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><span class="card-archive-list-count">25</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">117</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2021-12-06T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">219.2k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-03-28T11:00:02.236Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By ren_mcc</div><div class="footer_custom_text"><a rel="noopener external nofollow noreferrer noopener" target="_blank" href="https://beian.miit.gov.cn/"> <img class="icp-icon entered loading" alt="ICP" src="/img/icp.png" data-ll-status><span>京ICP备2022001205号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (true) {
        const sub = []
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: false,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = result.data.content
      }
    })
  })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><div class="aplayer no-destroy" data-id="7211977673" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="list" data-preload="none" data-autoplay="false" muted></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>