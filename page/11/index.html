<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ren_mccの博客 - 每天进步一点点</title><meta name="author" content="ren_mcc"><meta name="copyright" content="ren_mcc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一个收藏回忆与分享技术的地方！">
<meta property="og:type" content="website">
<meta property="og:title" content="ren_mccの博客">
<meta property="og:url" content="https://renm.cc/page/11/index.html">
<meta property="og:site_name" content="ren_mccの博客">
<meta property="og:description" content="一个收藏回忆与分享技术的地方！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://renm.cc/img/avatar2.webp">
<meta property="article:author" content="ren_mcc">
<meta property="article:tag" content="renmcc ren_mcc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://renm.cc/img/avatar2.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://renm.cc/page/11/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ren_mccの博客',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  isShuoshuo: false
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><script src="/js/jquery.min.js"></script><link rel="stylesheet" href="/js/function.min.css"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><script src="/js/custom.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg" style="background-image: url(/img/backgroud7.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar2.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">148</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ren_mccの博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="site-info"><h1 id="site-title">ren_mccの博客</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts nc" id="recent-posts"><div class="recent-post-items"><div class="recent-post-item"><div class="post_cover left"><a href="/20220915/kubernetes-20220915-18-devops/" title="18.devops"><img class="post-bg" src="/img/yuanshen/avatar/10002.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="18.devops"></a></div><div class="recent-post-info"><a class="article-title" href="/20220915/kubernetes-20220915-18-devops/" title="18.devops">18.devops</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-15T07:52:15.000Z" title="发表于 2022-09-15 15:52:15">2022-09-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 简介 开发运维一体化 CI/CD持续集成，持续交付  2. 部署harbor服务器 2.1 安装docker-ce 通过文章docker安装和加速安装docker-ce 2.2 安装harbor 通过文章harbor安装harbor 2.3 集群节点配置私有harbor 123vim /etc/containerd/config.toml        [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.10.251&quot;]          endpoint = [&quot;http://192.168.10.251&quot;] 重启服务 1systemctl restart containerd 3. 部署ops服务器 3.1 安装docker 通过文章docker安装和加速安装docker-ce 3.2 配置docker 配置私有harbor 12vim...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220915/kubernetes-20220915-17-%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E4%B8%8E%E9%99%90%E5%88%B6/" title="17.资源请求与限制"><img class="post-bg" src="/img/yuanshen/avatar/18d8bc3eb13533fac24510ce24edd01640345b22.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="17.资源请求与限制"></a></div><div class="recent-post-info"><a class="article-title" href="/20220915/kubernetes-20220915-17-%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E4%B8%8E%E9%99%90%E5%88%B6/" title="17.资源请求与限制">17.资源请求与限制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-14T16:49:40.000Z" title="发表于 2022-09-15 00:49:40">2022-09-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 简介 在kubernetets系统上，1个单位的CPU相当于虚拟机上的一颗虚拟CPU（vCPU）或者物理机上的一个超线程（HyperThread，或者称一个逻辑（CPU），它支持分数计量方式，一个核心（1core）相当于1000个微核心（millicores），因此500m相当于是0.5个核心，即二分之一个核心 2. resource字段来限制 创建pod做资源限制 1234567891011121314151617181920212223apiVersion: v1kind: Podmetadata:  creationTimestamp: null  labels:    run: pod1  name: pod1-newspec:  #serviceAccount: sa1  containers:  - image: centos    imagePullPolicy: IfNotPresent    name: pod1    resources:      requests:        memory: &quot;256Mi&quot;       ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220914/kubernetes-20220914-16-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83/" title="16.认证授权"><img class="post-bg" src="/img/yuanshen/avatar/2c28f19a6ca7404cbfba5e20e01dd898.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="16.认证授权"></a></div><div class="recent-post-info"><a class="article-title" href="/20220914/kubernetes-20220914-16-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83/" title="16.认证授权">16.认证授权</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-14T03:44:03.000Z" title="发表于 2022-09-14 11:44:03">2022-09-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 认证 1.1 token登录 1.1.1 生成token 1openssl rand -hex 10 1.1.2 创建认证文件 12cat /etc/kubernetes/pki/ren.csvd4cd5cf1f44fc9232f4c,ren,3 1.1.3 修改kube-api配置 1- --token-auth-file=/etc/kubernetes/pki/ren.csv 1.1.4 重启kubelet 1systemctl restart kubelet 1.1.5 登录 1kubectl -s https://172.17.203.55:6443 --insecure-skip-tls-verify=true --token=&quot;d4cd5cf1f44fc9232f4c&quot; get nodes 1.2 kubeconfig登录 123456789101112131415161718192021[root@node001 chap11-helm]# kubectl config viewapiVersion: v1clusters:-...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220913/kubernetes-20220913-15-helm/" title="15.helm"><img class="post-bg" src="/img/yuanshen/avatar/10003.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="15.helm"></a></div><div class="recent-post-info"><a class="article-title" href="/20220913/kubernetes-20220913-15-helm/" title="15.helm">15.helm</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-13T09:04:53.000Z" title="发表于 2022-09-13 17:04:53">2022-09-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 简介 helm的作用就是把许多的定义比如svc，deployment，seucrt一次性全部定义好，放在源里统一管理，方便部署到其他集群上。 2. 安装helm https://github.com/helm/helm/releases/tag/v3.2.1 tar zxf helm-v3.2.1-linux-amd64.tar.gz mv linux-amd64/helm /usr/local/bin/ 编辑/etc/profile source &lt;(helm completion bash) 保存退出 source /etc/profil 3. helm仓库 12345helm repo listhelm repo add azure http://mirror.azure.cn/kubernetes/charts/helm repo add github https://burdenbear.github.io/kube-charts-mirrorhelm repo add stable...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220913/kubernetes-20220913-14-%E7%BD%91%E7%BB%9C%E7%AD%96%E7%95%A5/" title="14.网络策略"><img class="post-bg" src="/img/yuanshen/avatar/9183h1124p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="14.网络策略"></a></div><div class="recent-post-info"><a class="article-title" href="/20220913/kubernetes-20220913-14-%E7%BD%91%E7%BB%9C%E7%AD%96%E7%95%A5/" title="14.网络策略">14.网络策略</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-13T07:14:35.000Z" title="发表于 2022-09-13 15:14:35">2022-09-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. pod间通信  2. 网络解决方案 CNI(container network interface) CNCF下的一个项目，由coreOS提出 通过插件的方式统一配置 flannel—基于overlay 不支持网络策略 calico—基于BGP 支持网络策略 canal 支持网络策略 3. 各种解决方案的对比  不管哪种解决方案，每个pod都有独立IP，可以直接通信，只是性能及配置的难易及是否支持网络策略 4. 网络策略 只允许特定的客户端能访问，其他客户端不能访问 1.此网络策略要保护谁 2.指定入口流量还是出口流量 3.具体的规则 4.1 查看集群是否有网络策略 1kubectl get networkpolicies 4.2 创建策略 只允指定网络能访问 1234567891011121314151617181920212223242526apiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata:  name: mypolicy1  namespace: chap10-netspec: ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220913/kubernetes-20220913-13-k8s%E5%AE%89%E8%A3%85calico%E6%97%B6%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E7%BD%91%E5%8D%A1/" title="13.k8s安装calico时如何选择网卡"><img class="post-bg" src="/img/yuanshen/avatar/3b87e950352ac65ca2697d55e516d01892138a91.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="13.k8s安装calico时如何选择网卡"></a></div><div class="recent-post-info"><a class="article-title" href="/20220913/kubernetes-20220913-13-k8s%E5%AE%89%E8%A3%85calico%E6%97%B6%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E7%BD%91%E5%8D%A1/" title="13.k8s安装calico时如何选择网卡">13.k8s安装calico时如何选择网卡</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-13T05:30:04.000Z" title="发表于 2022-09-13 13:30:04">2022-09-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 了解calico的通信 默认情况下calico使用的是IPIP模式进行通信，所有节点之间建立tunl0隧道，每创建一个pod在宿主机上都会产生一个以cali开头的虚拟接口，如下图pod1生成了一个calixxxx网卡，pod2生成了一个caliyyyy虚拟网卡。每个pod发出去的数据包会直接转发到cali开头的网卡，这个接口跟pod里的网卡是veth pair的关系。 veth...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220912/kubernetes-20220912-12-%E7%BD%91%E7%BB%9C/" title="12.calico通信"><img class="post-bg" src="/img/yuanshen/avatar/10007.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="12.calico通信"></a></div><div class="recent-post-info"><a class="article-title" href="/20220912/kubernetes-20220912-12-%E7%BD%91%E7%BB%9C/" title="12.calico通信">12.calico通信</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-12T15:09:26.000Z" title="发表于 2022-09-12 23:09:26">2022-09-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 安装etcd集群 通过文章部署etcd集群部署etcd集群 2. 安装docker-ce 通过文章docker安装和加速安装docker-ce 2.1 修改配置 修改docker启动脚本配置存储到etcd 1ExecStart=/usr/bin/dockerd --cluster-store=etcd://192.168.10.41:2379 -H fd:// --containerd=/run/containerd/containerd.sock 2.2 重启docker 12systemctl daemon-reloadsystemctl restart docker 3. 安装calico 3.1 创建目录 1mkdir /etc/calico 3.2 创建配置文件 [root@node003 ~]# cat /etc/calico/calicoctl.cfg 123456apiVersion: v1kind: calicoApiConfigmetadata:spec:  datastoreType: &quot;etcdv2&quot;  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220911/kubernetes-20220911-11-%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/" title="11.服务发布"><img class="post-bg" src="/img/yuanshen/avatar/72e25032ecca4e50849950cec4efd821.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="11.服务发布"></a></div><div class="recent-post-info"><a class="article-title" href="/20220911/kubernetes-20220911-11-%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/" title="11.服务发布">11.服务发布</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-11T05:29:10.000Z" title="发表于 2022-09-11 13:29:10">2022-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 简介 Service的出现，就是解决ip不固定的问题 当Pod宕机后重新生成时，其IP等状态信息可能会变动，Service会根据Pod的Label对这些状态信息进行监控和变更，保证上游服务不受Pod的变动而影响。 在 Kubernetes集群中，每个 Node运行一个 kube-proxy进程。 kube-proxy负责为 Service实现了一种 VIP（虚拟 IP）的形式，而不是 ExternalName的形式。在 Kubernetes v1.0版本，代理完全在 userspace。在 Kubernetes v1.1版本，新增了 iptables代理，但并不是默认的运行模式。从 Kubernetes v1.2起，默认就是 iptables代理。在 Kubernetes v1.8.0-beta.0中，添加了 ipvs代理。在 Kubernetes 1.14版本开始默认使用 ipvs代理。 2. Service 基础导论   客户端访问节点时通过 iptables实现的 iptables规则是通过 kube-proxy写入的 apiserver通过监控...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220910/kubernetes-20220910-10-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" title="10.定时任务"><img class="post-bg" src="/img/yuanshen/avatar/128170_111705817.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="10.定时任务"></a></div><div class="recent-post-info"><a class="article-title" href="/20220910/kubernetes-20220910-10-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" title="10.定时任务">10.定时任务</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-10T15:53:03.000Z" title="发表于 2022-09-10 23:53:03">2022-09-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 简介 Kubernetes jobs主要是针对短时和批量的工作负载。它是为了结束而运行的，而不是像deployment、replicasets、replication controllers和DaemonSets等其他对象那样持续运行。 Kubernetes Jobs会一直运行到Job中指定的任务完成。也就是说，如果pods给出退出代码0，那么Job就会退出。 2. job 2.1 创建job 1kubectl create job my-job --image=busybox --dry-run=client -o yaml -- &#x27;touch /tmp/abc.txt;sleep 10&#x27; &gt; myjob.yaml 1234567891011121314151617181920212223242526apiVersion: batch/v1kind: Jobmetadata:  creationTimestamp: null  name: my-jobspec:  backoffLimit: 6  completions: 6 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220910/kubernetes-20220910-9-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/" title="9.健康检查"><img class="post-bg" src="/img/yuanshen/avatar/10007.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="9.健康检查"></a></div><div class="recent-post-info"><a class="article-title" href="/20220910/kubernetes-20220910-9-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/" title="9.健康检查">9.健康检查</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-10T06:31:00.000Z" title="发表于 2022-09-10 14:31:00">2022-09-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/kubernetes/">kubernetes</a></span></div><div class="content">1. 简介 deployment的作用来维持pod的健壮性，当pod挂掉之后，deployment会生成新的pod，但如果pod是正常运行的，但pod里面出了问题，此时deployment是监测不到的。故此时需要探测（probe），用户定义出现什么样的状况才叫出问题，当probe监测到此问题，会认为pod出现了问题，执行重启大法来解决问题。 2. liveness prob 存活性探针，遇到问题会通过重启大法来解决问题，所谓重启就是删除pod里的容器，重新创建pod里的容器 2.1 支持的探测方式 1.command 2.httpGet 3.tcpSocket 2.2 command探测方式 12345678910111213141516171819202122apiVersion: v1kind: Podmetadata:  labels:    test: liveness  name: pod1spec:  containers:  - name: liveness    image: busybox    imagePullPolicy: IfNotPresent   ...</div></div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/10/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/#content-inner">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/#content-inner">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/#content-inner">15</a><a class="extend next" rel="next" href="/page/12/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar2.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ren_mcc</div><div class="author-info-description">一个收藏回忆与分享技术的地方！</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">148</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/renmcc"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/20230707/python-20230707-SockerServer/" title="SockerServer"><img src="/img/yuanshen/avatar/128763_7576398147.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SockerServer"/></a><div class="content"><a class="title" href="/20230707/python-20230707-SockerServer/" title="SockerServer">SockerServer</a><time datetime="2023-07-07T15:28:00.000Z" title="发表于 2023-07-07 23:28:00">2023-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230707/python-20230707-TCP%E7%BC%96%E7%A8%8B/" title="TCP编程"><img src="/img/yuanshen/avatar/20210501094036_cad73.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TCP编程"/></a><div class="content"><a class="title" href="/20230707/python-20230707-TCP%E7%BC%96%E7%A8%8B/" title="TCP编程">TCP编程</a><time datetime="2023-07-07T14:23:21.000Z" title="发表于 2023-07-07 22:23:21">2023-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230707/python-20230707-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B/" title="多线程和多进程"><img src="/img/yuanshen/avatar/20210501094035_643fc.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="多线程和多进程"/></a><div class="content"><a class="title" href="/20230707/python-20230707-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B/" title="多线程和多进程">多线程和多进程</a><time datetime="2023-07-07T13:42:46.000Z" title="发表于 2023-07-07 21:42:46">2023-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230707/python-20230707-%E9%93%BE%E6%8E%A5%E8%A1%A8/" title="链接表"><img src="/img/yuanshen/avatar/b2de9c82d158ccbf6a206a9f95e69137b03541ba.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="链接表"/></a><div class="content"><a class="title" href="/20230707/python-20230707-%E9%93%BE%E6%8E%A5%E8%A1%A8/" title="链接表">链接表</a><time datetime="2023-07-07T13:39:15.000Z" title="发表于 2023-07-07 21:39:15">2023-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230707/python-20230707-%E6%89%93%E5%8C%85%E5%88%86%E5%8F%91/" title="打包分发"><img src="/img/yuanshen/avatar/10008.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="打包分发"/></a><div class="content"><a class="title" href="/20230707/python-20230707-%E6%89%93%E5%8C%85%E5%88%86%E5%8F%91/" title="打包分发">打包分发</a><time datetime="2023-07-07T13:37:05.000Z" title="发表于 2023-07-07 21:37:05">2023-07-07</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
      <i class="fas fa-angle-right"></i></a>
          </div>
          <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JavaScript/"><span class="card-category-list-name">JavaScript</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/containerd/"><span class="card-category-list-name">containerd</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/docker/"><span class="card-category-list-name">docker</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/docker-compose/"><span class="card-category-list-name">docker-compose</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/git/"><span class="card-category-list-name">git</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/golang/"><span class="card-category-list-name">golang</span><span class="card-category-list-count">38</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/istio/"><span class="card-category-list-name">istio</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kafka/"><span class="card-category-list-name">kafka</span><span class="card-category-list-count">2</span></a></li>
          </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/containerd/" style="font-size: 1.28em; color: rgb(123, 171, 104);">containerd</a><a href="/tags/JavaScript/" style="font-size: 1.15em; color: rgb(84, 134, 153);">JavaScript</a><a href="/tags/docker/" style="font-size: 1.35em; color: rgb(150, 57, 73);">docker</a><a href="/tags/git/" style="font-size: 1.15em; color: rgb(50, 50, 69);">git</a><a href="/tags/docker-compose/" style="font-size: 1.25em; color: rgb(95, 120, 111);">docker-compose</a><a href="/tags/istio/" style="font-size: 1.35em; color: rgb(118, 50, 135);">istio</a><a href="/tags/kubrnetes/" style="font-size: 1.32em; color: rgb(167, 198, 50);">kubrnetes</a><a href="/tags/kubernetes/" style="font-size: 1.38em; color: rgb(190, 100, 50);">kubernetes</a><a href="/tags/golang/" style="font-size: 1.45em; color: rgb(69, 99, 50);">golang</a><a href="/tags/kafka/" style="font-size: 1.18em; color: rgb(73, 50, 81);">kafka</a><a href="/tags/nginx/" style="font-size: 1.15em; color: rgb(50, 67, 131);">nginx</a><a href="/tags/python/" style="font-size: 1.42em; color: rgb(51, 116, 50);">python</a><a href="/tags/rancher/" style="font-size: 1.22em; color: rgb(132, 96, 200);">rancher</a><a href="/tags/redis/" style="font-size: 1.18em; color: rgb(50, 91, 72);">redis</a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.15em; color: rgb(163, 148, 52);">工具</a><a href="/tags/vue/" style="font-size: 1.25em; color: rgb(50, 98, 50);">vue</a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.22em; color: rgb(170, 63, 105);">大数据</a></div></div><div class="card-widget card-archives">
    <div class="item-headline">
      <i class="fas fa-archive"></i>
      <span>归档</span>
      <a class="card-more-btn" href="/archives/" title="查看更多"><i class="fas fa-angle-right"></i></a>
    </div>
    <ul class="card-archive-list">
  
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/07/">
          <span class="card-archive-list-date">七月 2023</span>
          <span class="card-archive-list-count">20</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/06/">
          <span class="card-archive-list-date">六月 2023</span>
          <span class="card-archive-list-count">17</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/04/">
          <span class="card-archive-list-date">四月 2023</span>
          <span class="card-archive-list-count">1</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/03/">
          <span class="card-archive-list-date">三月 2023</span>
          <span class="card-archive-list-count">6</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/02/">
          <span class="card-archive-list-date">二月 2023</span>
          <span class="card-archive-list-count">3</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/01/">
          <span class="card-archive-list-date">一月 2023</span>
          <span class="card-archive-list-count">7</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2022/12/">
          <span class="card-archive-list-date">十二月 2022</span>
          <span class="card-archive-list-count">25</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2022/11/">
          <span class="card-archive-list-date">十一月 2022</span>
          <span class="card-archive-list-count">3</span>
        </a>
      </li>
    </ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站信息</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">148</div></div><div class="webinfo-item"><div class="item-name">运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2021-12-06T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总浏览量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-12-27T01:07:02.089Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By ren_mcc</div><div class="footer_custom_text"><a rel="noopener external nofollow noreferrer noopener" target="_blank" href="https://beian.miit.gov.cn/"> <img class="icp-icon entered loading" alt="ICP" src="/img/icp.png" data-ll-status><span>京ICP备2022001205号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>window.typedJSFn = {
  init: str => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: subtitleType => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        btf.getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
btf.addGlobalFn('pjaxSendOnce', () => { typed.destroy() }, 'typedDestroy')
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["风带来故事的种子,时间使之发芽。"])
  } else {
    document.getElementById("subtitle").textContent = "风带来故事的种子,时间使之发芽。"
  }
}
typedJSFn.run(subtitleType)</script></div><div class="aplayer no-destroy" data-id="7211977673" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="list" data-preload="none" data-autoplay="false" muted></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/docker/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🐱 docker (8)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/docker-compose/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 docker-compose (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/containerd/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎮 containerd (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/kubernetes/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 kubernetes (27)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/python/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 python (37)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/golang/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 golang (38)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 redis (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/kafka/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 kafka (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://renm.cc/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><!-- hexo injector body_end end --></body></html>