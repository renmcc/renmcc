<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>k8s基础环境配置 | ren_mccの博客</title><meta name="author" content="ren_mcc"><meta name="copyright" content="ren_mcc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1 主机基础配置 1.1 主机名配置 因为 K8S 或者 FQDN 的规定，主机名仅支持包含 - 或&#x2F;和 .(中横线和点)两种特殊符号，并且一个集群中主机名不能重复。 1.2 Hosts  Linux 系统安装完成后，在 hosts(&#x2F;etc&#x2F;hosts) 中应该有 localhost 指向 127.0.0.1，如果没有则手动添加上。 配置每台主机的 hosts(&#x2F;etc&#x2F;hosts)，添加 ho">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s基础环境配置">
<meta property="og:url" content="https://renm.cc/20220216/kubernetes-20220216-k8s%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="ren_mccの博客">
<meta property="og:description" content="1 主机基础配置 1.1 主机名配置 因为 K8S 或者 FQDN 的规定，主机名仅支持包含 - 或&#x2F;和 .(中横线和点)两种特殊符号，并且一个集群中主机名不能重复。 1.2 Hosts  Linux 系统安装完成后，在 hosts(&#x2F;etc&#x2F;hosts) 中应该有 localhost 指向 127.0.0.1，如果没有则手动添加上。 配置每台主机的 hosts(&#x2F;etc&#x2F;hosts)，添加 ho">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://renm.cc/img/yuanshen/avatar/1000111.webp">
<meta property="article:published_time" content="2022-02-16T01:15:21.000Z">
<meta property="article:modified_time" content="2023-06-28T13:47:21.789Z">
<meta property="article:author" content="ren_mcc">
<meta property="article:tag" content="kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://renm.cc/img/yuanshen/avatar/1000111.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://renm.cc/20220216/kubernetes-20220216-k8s%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'k8s基础环境配置',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><script src="/js/jquery.min.js"></script><link rel="stylesheet" href="/js/function.min.css"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><script src="/js/custom.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg" style="background-image: url(/img/backgroud7.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar2.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">148</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/yuanshen/avatar/1000111.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ren_mccの博客</span></a><a class="nav-page-title" href="/"><span class="site-name">k8s基础环境配置</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">k8s基础环境配置</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-16T01:15:21.000Z" title="发表于 2022-02-16 09:15:21">2022-02-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-28T13:47:21.789Z" title="更新于 2023-06-28 21:47:21">2023-06-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/kubernetes/">kubernetes</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-06-28 21:47:21&quot;}" hidden></div><h1>1 主机基础配置</h1>
<h2 id="1-1-主机名配置">1.1 主机名配置</h2>
<p>因为 K8S 或者 <code>FQDN</code> 的规定，主机名仅支持包含 <code>-</code> 或/和 <code>.</code>(中横线和点)两种特殊符号，并且一个集群中主机名不能重复。</p>
<h2 id="1-2-Hosts">1.2 Hosts</h2>
<ol>
<li>Linux 系统安装完成后，在 <code>hosts(/etc/hosts)</code> 中应该有 <code>localhost</code> 指向 <code>127.0.0.1</code>，如果没有则手动添加上。</li>
<li>配置每台主机的 hosts(/etc/hosts)，添加 <code>host_ip $hostname</code> 到 <code>/etc/hosts</code> 文件中。</li>
</ol>
<h2 id="1-3-CentOS-关闭-selinux">1.3 CentOS 关闭 selinux</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>
<h2 id="1-4-关闭防火墙-可选-或者放行相应端口">1.4 关闭防火墙(可选)或者放行相应端口</h2>
<ul>
<li>
<p>CentOS</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service &amp;&amp; systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Ubuntu</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="1-5-配置主机时间、时区、系统语言">1.5 配置主机时间、时区、系统语言</h2>
<p>查看时区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -R 或者 timedatectl</span><br></pre></td></tr></table></figure>
<p>修改时区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>
<p>修改系统语言环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span> &gt;&gt; /etc/profile; <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<p>配置主机 NTP 时间同步</p>
<h2 id="1-6-配置主机-DNS-服务器">1.6 配置主机 DNS 服务器</h2>
<p>对于类似 Ubuntu 18 这类默认使用 <code>systemd-resolve</code> 管理 DNS 服务器的系统，建议禁用 <code>systemd-resolved</code> 服务，然后手动配置 DNS。</p>
<p>因为 <code>systemd-resolve</code> 会使用 <code>127.0.x.x</code> 这样的 IP 来作为默认的 DNS 服务器地址，这个是主机的环回地址。这个地址传递到容器环境中后，容器应用无法访问这个地址。</p>
<p>操作方法：</p>
<p>1.禁用 systemd-resolved.service</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> systemd-resolved.service</span><br><span class="line">systemctl stop systemd-resolved.service</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/resolv.conf; <span class="built_in">touch</span> /etc/resolv.conf</span><br></pre></td></tr></table></figure>
<p>2.接着编辑 <code>/etc/resolv.conf</code> 添加 DNS 服务器<br>
3.重启 docker 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload; systemctl restart docker</span><br></pre></td></tr></table></figure>
<h1>2 Kernel 调优</h1>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/sysctl.conf&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.forwarding=1</span></span><br><span class="line"><span class="string"># 参考 https://github.com/prometheus/node_exporter#disabled-by-default</span></span><br><span class="line"><span class="string">kernel.perf_event_paranoid=-1</span></span><br><span class="line"><span class="string">kernel.watchdog_thresh=30</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables=1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables=1</span></span><br><span class="line"><span class="string"># 存在于 ARP 高速缓存中的最少层数，如果少于这个数，垃圾收集器将不会运行，默认值：128。</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh1=128</span></span><br><span class="line"><span class="string"># 保存在 ARP 高速缓存中的最大记录软限制。垃圾收集器在开始收集前，允许记录数超过这个数字 5 秒。默认值：512。</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh2=6144</span></span><br><span class="line"><span class="string"># 保存在 ARP 高速缓存中的最大记录的硬限制，一旦高速缓存中的数目高于此，垃圾收集器将马上运行。默认值：1024。</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh3=8192</span></span><br><span class="line"><span class="string"># 决定检查一次相邻层记录的有效性的周期。当相邻层记录失效时，将在给它发送数据前，再解析一次。默认值：60 秒。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 系统中所有进程能够同时打开的文件句柄数量</span></span><br><span class="line"><span class="string">fs.file-max=2097152</span></span><br><span class="line"><span class="string"># 设置每个用户可以运行的 inotifywait 或 inotifywatch 命令的进程数。</span></span><br><span class="line"><span class="string">fs.inotify.max_user_instances=8192</span></span><br><span class="line"><span class="string"># inotify 用于监控文件系统事件，该文件中的值为调用 inotify_init 函数时分配给 inotify 队列的事件数目的最大值，超出这个值得事件被丢弃，但会触发 IN_Q_OVERFLOW 事件，文件系统变化越频繁，这个值就应该越大</span></span><br><span class="line"><span class="string">fs.inotify.max_queued_events=16384</span></span><br><span class="line"><span class="string"># IO 复用 epoll 监听文件句柄的数量最大值</span></span><br><span class="line"><span class="string">fs.inotify.max_user_watches=524288</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vm.swappiness=0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies=1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout=30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_synack_retries=2</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog=8096</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_recycle=0</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 1048576</span></span><br><span class="line"><span class="string">kernel.randomize_va_space = 0</span></span><br><span class="line"><span class="string">net.core.somaxconn = 1024</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>数值根据实际环境自行配置，最后执行 sysctl -p 保存配置。</p>
</blockquote>
<h1>3 连接数调整</h1>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">root soft nofile 655350</span></span><br><span class="line"><span class="string">root hard nofile 655350</span></span><br><span class="line"><span class="string">* soft nofile 655350</span></span><br><span class="line"><span class="string">* hard nofile 655350</span></span><br><span class="line"><span class="string">* soft nproc unlimited</span></span><br><span class="line"><span class="string">* hard nproc unlimited</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h1>4 Docker 安装与配置</h1>
<h2 id="4-1-Docker-安装">4.1 Docker 安装</h2>
<h3 id="4-1-1-修改系统源">4.1.1 修改系统源</h3>
<ul>
<li>Ubuntu</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">sed -i <span class="string">&#x27;s/archive.ubuntu.com/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list</span><br><span class="line">sed -i <span class="string">&#x27;s/security.ubuntu.com/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">apt-get update</span><br></pre></td></tr></table></figure>
<ul>
<li>Centos 7.x</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum install ca-certificates ;</span><br><span class="line">update-ca-trust;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -rf /etc/yum.repos.d /etc/yum.repos.d.backup</span><br><span class="line"></span><br><span class="line">sed -e <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \</span><br><span class="line">    -e <span class="string">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.ustc.edu.cn/centos|g&#x27;</span> \</span><br><span class="line">    -i.bak /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line"></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<ul>
<li>centos8.x</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -rf /etc/yum.repos.d /etc/yum.repos.d.backup</span><br><span class="line"></span><br><span class="line">sed -e <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \</span><br><span class="line">    -e <span class="string">&#x27;s|^#baseurl=http://mirror.centos.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/centos|g&#x27;</span> \</span><br><span class="line">    -i.bak \</span><br><span class="line">    /etc/yum.repos.d/CentOS-Linux-AppStream.repo \</span><br><span class="line">    /etc/yum.repos.d/CentOS-Linux-BaseOS.repo \</span><br><span class="line">    /etc/yum.repos.d/CentOS-Linux-Extras.repo \</span><br><span class="line">    /etc/yum.repos.d/CentOS-Linux-PowerTools.repo \</span><br><span class="line">    /etc/yum.repos.d/CentOS-Linux-Plus.repo</span><br><span class="line"></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<h3 id="4-1-2-Docker-ce-安装">4.1.2 Docker-ce 安装</h3>
<ul>
<li>Ubuntu</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义用户名</span></span><br><span class="line">NEW_USER=rancher</span><br><span class="line"><span class="comment"># 添加用户(可选)</span></span><br><span class="line">sudo adduser <span class="variable">$NEW_USER</span></span><br><span class="line"><span class="comment"># 为新用户设置密码</span></span><br><span class="line">sudo passwd <span class="variable">$NEW_USER</span></span><br><span class="line"><span class="comment"># 为新用户添加 sudo 权限</span></span><br><span class="line">sudo <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NEW_USER</span> ALL=(ALL) ALL&quot;</span> &gt;&gt; /etc/sudoers</span><br><span class="line"><span class="comment"># 定义安装版本</span></span><br><span class="line"><span class="built_in">export</span> docker_version=18.09.9;</span><br><span class="line"><span class="comment"># 删除旧的 docker 组件</span></span><br><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc -y;</span><br><span class="line"><span class="comment"># 更新 apt 源</span></span><br><span class="line">sudo apt-get update;</span><br><span class="line"><span class="comment"># 对系统进行全面的更新升级，推荐升级一下（可选）</span></span><br><span class="line">sudo apt-get -y upgrade;</span><br><span class="line"><span class="comment"># 安装必要的一些系统工具</span></span><br><span class="line">sudo apt-get -y install apt-transport-https ca-certificates \</span><br><span class="line">    curl software-properties-common bash-completion  gnupg-agent;</span><br><span class="line"><span class="comment"># 安装 GPG 证书</span></span><br><span class="line">sudo curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | \</span><br><span class="line">    sudo apt-key add -;</span><br><span class="line"><span class="comment"># 添加 Docker APT 源</span></span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span>;</span><br><span class="line"><span class="comment"># 更新并安装 Docker-CE</span></span><br><span class="line">sudo apt-get -y update;</span><br><span class="line">install_version=$( apt-cache madison docker-ce | grep <span class="variable">$&#123;docker_version&#125;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> );</span><br><span class="line"><span class="comment"># --allow-downgrades 允许降级安装</span></span><br><span class="line">sudo apt-get -y install docker-ce=<span class="variable">$&#123;install_version&#125;</span> docker-ce-cli=<span class="variable">$&#123;install_version&#125;</span> --allow-downgrades;</span><br><span class="line"><span class="comment"># 把当前用户加入 docker 组</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$NEW_USER</span>;</span><br><span class="line"><span class="comment"># 设置开机启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker;</span><br><span class="line"><span class="comment"># 清理不需要的依赖</span></span><br><span class="line">apt-get autoremove  -y</span><br></pre></td></tr></table></figure>
<ul>
<li>Centos</li>
</ul>
<blockquote>
<p>注意：在安装的时候如果提示 containerd 版本过低，则需要访问 <a target="_blank" rel="noopener" href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages">https://download.docker.com/linux/centos/7/x86_64/stable/Packages</a> 下载最新版本的 containerd 到本地，然后运行 yum localinstall xxx.rpm 进行安装。</p>
</blockquote>
<blockquote>
<p>因为 CentOS 的安全限制，通过 RKE 安装 K8S 集群时候无法使用 root 账户。所以，建议 CentOS 用户使用非 root 用户来运 docker，不管是 RKE 还是 custom 安装 k8s。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义用户名</span></span><br><span class="line">NEW_USER=rancher</span><br><span class="line"><span class="comment"># 添加用户(可选)</span></span><br><span class="line">sudo adduser <span class="variable">$NEW_USER</span></span><br><span class="line"><span class="comment"># 为新用户设置密码</span></span><br><span class="line">sudo passwd <span class="variable">$NEW_USER</span></span><br><span class="line"><span class="comment"># 为新用户添加 sudo 权限</span></span><br><span class="line">sudo <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NEW_USER</span> ALL=(ALL) ALL&quot;</span> &gt;&gt; /etc/sudoers</span><br><span class="line"><span class="comment"># 卸载旧版本 Docker 软件</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">              docker-client \</span><br><span class="line">              docker-client-latest \</span><br><span class="line">              docker-common \</span><br><span class="line">              docker-latest \</span><br><span class="line">              docker-latest-logrotate \</span><br><span class="line">              docker-logrotate \</span><br><span class="line">              docker-selinux \</span><br><span class="line">              docker-engine-selinux \</span><br><span class="line">              docker-engine \</span><br><span class="line">              container*</span><br><span class="line"><span class="comment"># 定义安装版本</span></span><br><span class="line"><span class="built_in">export</span> docker_version=18.06.3</span><br><span class="line"><span class="comment"># 对系统进行全面的更新升级，推荐升级一下（可选）</span></span><br><span class="line">sudo yum update -y;</span><br><span class="line"><span class="comment"># 安装必要的一些系统工具</span></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data \</span><br><span class="line">    lvm2 bash-completion;</span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息</span></span><br><span class="line">sudo yum-config-manager --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo;</span><br><span class="line"><span class="comment"># Step 3: 更新并安装 Docker-CE</span></span><br><span class="line">sudo yum makecache all;</span><br><span class="line">version=$(yum list docker-ce.x86_64 --showduplicates | <span class="built_in">sort</span> -r|grep <span class="variable">$&#123;docker_version&#125;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>);</span><br><span class="line">sudo yum -y install --<span class="built_in">setopt</span>=obsoletes=0 docker-ce-<span class="variable">$&#123;version&#125;</span> docker-ce-selinux-<span class="variable">$&#123;version&#125;</span>;</span><br><span class="line"><span class="comment"># 如果已经安装高版本 Docker,可进行降级安装(可选)</span></span><br><span class="line">yum downgrade --<span class="built_in">setopt</span>=obsoletes=0 -y docker-ce-<span class="variable">$&#123;version&#125;</span> docker-ce-selinux-<span class="variable">$&#123;version&#125;</span>;</span><br><span class="line"><span class="comment"># 把当前用户加入 docker 组</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$NEW_USER</span>;</span><br><span class="line"><span class="comment"># 设置开机启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker;</span><br></pre></td></tr></table></figure>
<h3 id="4-1-3-锁定-Docker-版本">4.1.3 锁定 Docker 版本</h3>
<p>可能因为某些原因无意间执行了 <code>yum update</code> 或者 <code>apt-get -y upgrade</code>;导致 Docker 版本升级。为了避免此类问题发生，建议在安装好 Docker 后对 Docker 软件进行锁定，防止 Docker 意外更新。</p>
<ul>
<li>centos<br>
安装 yum-plugin-versionlock 插件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-plugin-versionlock</span><br></pre></td></tr></table></figure>
<p>锁定软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum versionlock add docker-ce docker-ce-cli</span><br><span class="line"></span><br><span class="line">[root@izwz969o7lu6t9lh4ta6m5z ~]<span class="comment"># yum versionlock add docker-ce docker-ce-cli</span></span><br><span class="line">已加载插件：fastestmirror, versionlock</span><br><span class="line">Adding versionlock on: 0:docker-ce-17.06.2.ce-3.el7.centos</span><br><span class="line">versionlock added: 1</span><br><span class="line">[root@izwz969o7lu6t9lh4ta6m5z ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>查看已锁定的软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum versionlock list</span><br></pre></td></tr></table></figure>
<p>解锁指定的软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum versionlock delete &lt;软件包名称&gt;</span><br></pre></td></tr></table></figure>
<p>解锁所有的软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum versionlock clear</span><br></pre></td></tr></table></figure>
<ul>
<li>Ubuntu<br>
锁定软件：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-mark hold docker-ce docker-ce-cli</span><br></pre></td></tr></table></figure>
<p>查看已锁定的软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-mark showhold</span><br></pre></td></tr></table></figure>
<p>软件包被锁定后，再次执行 apt-get upgrade 可以看到以下日志提示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@alihost-03:/home/docker<span class="comment"># apt-get  upgrade</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">Calculating upgrade... Done</span><br><span class="line">The following packages have been kept back:</span><br><span class="line">  docker-ce docker-ce-cli linux-generic linux-headers-generic linux-image-generic ubuntu-minimal</span><br><span class="line">0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.</span><br><span class="line">root@alihost-03:/home/docker<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>被锁定的软件不会再升级。</p>
<p>解除锁定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-mark unhold docker-ce docker-ce-cli</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line"><span class="comment">## 4.2 Docker 配置</span></span><br><span class="line">对于通过 systemd 来管理服务的系统(比如 CentOS7.X、Ubuntu16.X)，Docker 有两处可以配置参数: 一个是 `docker.service` 服务配置文件，一个是 Docker daemon 配置文件 daemon.json。</span><br><span class="line"></span><br><span class="line">1. docker.service</span><br><span class="line"></span><br><span class="line">对于 CentOS 系统，docker.service 默认位于 `/usr/lib/systemd/system/docker.service`；对于 Ubuntu 系统，docker.service 默认位于 `/lib/systemd/system/docker.service`</span><br><span class="line"></span><br><span class="line">2. daemon.json</span><br><span class="line"></span><br><span class="line">daemon.json 默认位于 `/etc/docker/daemon.json`，如果没有可手动创建，基于 systemd 管理的系统都是相同的路径。通过修改 daemon.json 来改过 Docker 配置，也是 Docker 官方推荐的方法。</span><br><span class="line"></span><br><span class="line">&gt; 以下说明均基于 systemd，并通过 `/etc/docker/daemon.json` 来修改配置。</span><br><span class="line"></span><br><span class="line"><span class="comment">### 4.2.1 配置镜像下载和上传并发数</span></span><br><span class="line">从 Docker1.12 开始，支持自定义下载和上传镜像的并发数，默认值上传为 3 个并发，下载为 5 个并发。通过添加”max-concurrent-downloads”和”max-concurrent-uploads”参数对其修改:</span><br><span class="line">``` bash</span><br><span class="line"><span class="string">&quot;max-concurrent-downloads&quot;</span>: 3,</span><br><span class="line"><span class="string">&quot;max-concurrent-uploads&quot;</span>: 5</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-配置镜像加速地址">4.2.2 配置镜像加速地址</h3>
<p>Rancher 从 v1.6.15 开始到 v2.x.x,Rancher 系统相关的所有镜像(包括 1.6.x 上的 K8S 镜像)都托管在 Dockerhub 仓库。Dockerhub 节点在国外，国内直接拉取镜像会有些缓慢。为了加速镜像的下载，可以给 Docker 配置国内的镜像地址。</p>
<p>编辑 <code>/etc/docker/daemon.json</code> 加入以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://7bezldxe.mirror.aliyuncs.com/&quot;</span>,<span class="string">&quot;https://IP:PORT/&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以设置多个 registry-mirrors 地址，以数组形式书写，地址需要添加协议头(https 或者 http)。</p>
</blockquote>
<h3 id="4-2-3-配置-insecure-registries私有仓库">4.2.3 配置 insecure-registries私有仓库</h3>
<p>Docker 默认只信任 TLS 加密的仓库地址(https)，所有非 https 仓库默认无法登陆也无法拉取镜像。<code>insecure-registries</code> 字面意思为不安全的仓库，通过添加这个参数对非 https 仓库进行授信。可以设置多个 <code>insecure-registries</code> 地址，以数组形式书写，地址不能添加协议头(http)。</p>
<p>编辑 /etc/docker/daemon.json 加入以下内容:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;192.168.1.100&quot;</span>,<span class="string">&quot;IP:PORT&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-配置-Docker-存储驱动">4.2.4 配置 Docker 存储驱动</h3>
<p>OverlayFS 是一个新一代的联合文件系统，类似于 AUFS，但速度更快，实现更简单。Docker 为 OverlayFS 提供了两个存储驱动程序:旧版的 <code>overlay</code>，新版的 <code>overlay2</code>(更稳定)。</p>
<p>先决条件:</p>
<ul>
<li>overlay2: Linux 内核版本 4.0 或更高版本，或使用内核版本 3.10.0-514+的 RHEL 或 CentOS。</li>
<li>overlay: 主机 Linux 内核版本 3.18+</li>
<li>支持的磁盘文件系统
<ul>
<li>ext4(仅限 RHEL 7.1)</li>
<li>xfs(RHEL7.2 及更高版本)，需要启用 d_type=true。</li>
</ul>
</li>
</ul>
<p>编辑 /etc/docker/daemon.json 加入以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;storage-driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line"><span class="string">&quot;storage-opts&quot;</span>: [<span class="string">&quot;overlay2.override_kernel_check=true&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-5-配置日志驱动">4.2.5 配置日志驱动</h3>
<p>容器在运行时会产生大量日志文件，很容易占满磁盘空间。通过配置日志驱动来限制文件大小与文件的数量。</p>
<blockquote>
<p>限制单个日志文件为 100M,最多产生 3 个日志文件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line"><span class="string">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max-size&quot;</span>: <span class="string">&quot;100m&quot;</span>,</span><br><span class="line">    <span class="string">&quot;max-file&quot;</span>: <span class="string">&quot;3&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-6-可选-修改-Docker0-默认-网络接口-IP-地址">4.2.6 (可选)修改 Docker0 默认 网络接口 IP 地址</h3>
<p>Docker 第一次运行时会自动创建名为 docker0 的网络接口，默认接口地址为 172.17.0.1/16。在一些企业中，可能已经使用了这个网段的地址，或者规划以后会使用这个网段的地址。所以，建议在安装好 docker 服务后，第一时间修改 docker0 接口地址，避免后期出现网段冲突。</p>
<ul>
<li>停止 docker 运行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker.service</span><br></pre></td></tr></table></figure>
<ul>
<li>删除已有的 docker0 接口</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip <span class="built_in">link</span> del docker0</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>修改 docker 配置文件<br>
在 /etc/docker/daemon.json 中添加 “bip”: “192.168.100.1/24”,</p>
</li>
<li>
<p>重启启动 docker</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> docker; systemctl daemon-reload; systemctl restart docker;</span><br></pre></td></tr></table></figure>
<ul>
<li>docker.service 配置
<ol>
<li>对于 CentOS 系统，docker.service 默认位于 /usr/lib/systemd/system/docker.service；</li>
<li>对于 Ubuntu 系统，docker.service 默认位于 /lib/systemd/system/docker.service。</li>
</ol>
</li>
</ul>
<p>编辑 docker.service，添加以下参数。</p>
<ul>
<li>防止 docker 服务 OOM： <code>OOMScoreAdjust=-1000</code></li>
<li>开启 iptables 转发链：<br>
<code>ExecStartPost=/usr/sbin/iptables -P FORWARD ACCEPT</code></li>
</ul>
<img src="/20220216/kubernetes-20220216-k8s%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20190615165436722.ea672a70.png" class="" title="执行结果">
<h3 id="4-2-7-Ubuntu-Debian-系统-，docker-info-提示-WARNING-No-swap-limit-support">4.2.7 Ubuntu\Debian 系统 ，docker info 提示 WARNING: No swap limit support</h3>
<p>Ubuntu\Debian 系统下，默认 cgroups 未开启 swap account 功能，这样会导致设置容器内存或者 swap 资源限制不生效。可以通过以下命令解决:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统一网卡名称为 ethx</span></span><br><span class="line">sudo sed -i <span class="string">&#x27;s/en[[:alnum:]]*/eth0/g&#x27;</span> /etc/network/interfaces;</span><br><span class="line">sudo sed -i <span class="string">&#x27;s/GRUB_CMDLINE_LINUX=&quot;\(.*\)&quot;/GRUB_CMDLINE_LINUX=&quot;net.ifnames=0 cgroup_enable=memory swapaccount=1 biosdevname=0 \1&quot;/g&#x27;</span> /etc/default/grub;</span><br><span class="line">sudo update-grub;</span><br></pre></td></tr></table></figure>
<p>注意 通过以上命令可自动配置参数，如果 /etc/default/grub 非默认配置，需根据实际参数做调整。 提示 以上配置完成后，建议重启一次主机</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://renm.cc">ren_mcc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://renm.cc/20220216/kubernetes-20220216-k8s%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">https://renm.cc/20220216/kubernetes-20220216-k8s%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://renm.cc" target="_blank">ren_mccの博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/kubernetes/">kubernetes</a></div><div class="post-share"><div class="social-share" data-image="/img/yuanshen/avatar/1000111.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/20220216/rancher-20220216-%E6%B5%8B%E8%AF%95HPA/" title="测试HPA"><img class="cover" src="/img/yuanshen/avatar/1000.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">测试HPA</div></div><div class="info-2"><div class="info-item-1">1. HPA 工作原理 Pod 弹性伸缩器（HPA）是 Kubernetes 的一项功能，可以对您的应用进行自动扩容和自动缩容。 1.1 为什么要使用 HPA？ 使用 HPA，您可以自动缩放在 Replication Controller，Deployment 或者 Replica Set 中的 Pod。HPA 将自动缩放正在运行的 Pod 的数量，以实现最高效率。HPA 中影响 Pod 数量的因素包括：  用户定义的允许运行的 Pod 的最小和最大数量。 资源指标中报告的观察到的 CPU 或内存使用情况。 第三方指标应用程序（例如 Prometheus，Datadog 等）提供的自定义指标。  HPA 通过以下方式改善您的服务：  释放因过多的 Pod 而浪费的硬件资源。 按照应用需要的性能，自动提高或降低 Pod 数量。  1.2 HPA 是如何工作的？  HPA 是通过循环控制来实现的，其循环周期由下面的 kube-controller-manager...</div></div></div></a><a class="pagination-related" href="/20220213/rancher-20220215-helm2%E5%8D%87%E7%BA%A7rancher2-2-2%E5%88%B0rancher2-3-2/" title="helm2升级rancher2-2-2到rancher2-3-2"><img class="cover" src="/img/yuanshen/avatar/128860_43586076260.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">helm2升级rancher2-2-2到rancher2-3-2</div></div><div class="info-2"><div class="info-item-1">1. 集群现状 rke部署工具版本 12[root@localhost rke2.2.2]# ./rke -versionrke version v0.2.6 rke部署k8s集群版本（用于高可用部署rancher） 123[root@localhost rke2.2.2]# kubectl versionClient Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;14&quot;, GitVersion:&quot;v1.14.3&quot;, GitCommit:&quot;5e53fd6bc17c0dec8434817e69b04a25d8ae0ff0&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-06-06T01:44:30Z&quot;, GoVersion:&quot;go1.12.5&quot;, Compiler:&quot;gc&quot;,...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/20220228/istio-20220228-1-%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/" title="1.服务网格"><img class="cover" src="/img/yuanshen/avatar/97400f365b0b47cf8533d9d0b4ebe150!400x400.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-28</div><div class="info-item-2">1.服务网格</div></div><div class="info-2"><div class="info-item-1">1. 前言 如果你比较关注新兴技术的话，那么很可能在不同的地方听说过 istio，并且知道它和 service mesh 有着牵扯。这篇文章可以作为了解 istio 的入门介绍，了解什么是 istio，istio 为什么最近这么火，以及 istio 能够我们带来什么好处。 2. 什么是 istio？ 官方对 istio 的介绍浓缩成了一句话：  An open platform to connect, secure, control and observe services.  翻译过来，就是”连接、安全加固、控制和观察服务的开放平台“。开放平台就是指它本身是开源的，服务对应的是微服务，也可以粗略地理解为单个应用。 中间的四个动词就是 istio 的主要功能，官方也各有一句话的说明。这里再阐释一下：  连接（Connect）：智能控制服务之间的调用流量，能够实现灰度升级、AB 测试和红黑部署等功能 安全加固（Secure）：自动为服务之间的调用提供认证、授权和加密 控制（Control）：应用用户定义的...</div></div></div></a><a class="pagination-related" href="/20220210/kubernetes-20220210-kubectl%E5%91%BD%E4%BB%A4%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8/" title="kubectl命令自动补全"><img class="cover" src="/img/yuanshen/avatar/42f268bdcc7059cc27fd69a639c7c6f0253fe1c4.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-10</div><div class="info-item-2">kubectl命令自动补全</div></div><div class="info-2"><div class="info-item-1">1234567yum install -y bash-completionsource /usr/share/bash-completion/bash_completionsource &lt;(kubectl completion bash)echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrcecho &quot;source &lt;(helm completion bash)&quot; &gt;&gt; ~/.bashrc </div></div></div></a><a class="pagination-related" href="/20220806/kubernetes-20220806-1-k8s%E7%AE%80%E4%BB%8B/" title="1.k8s简介"><img class="cover" src="/img/yuanshen/avatar/bf096b63f6246b60841dc6d1f61c7845500fa275.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-06</div><div class="info-item-2">1.k8s简介</div></div><div class="info-2"><div class="info-item-1">1. 简介   我们可以使用docker run或nerdctl run这样的命令来创建一个一个的容器，...</div></div></div></a><a class="pagination-related" href="/20220906/kubernetes-20220906-3-k8s%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%AE%A1%E7%90%86/" title="3.k8s的基本管理"><img class="cover" src="/img/yuanshen/avatar/20210501094035_643fc.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-06</div><div class="info-item-2">3.k8s的基本管理</div></div><div class="info-2"><div class="info-item-1">1. 了解namespace 集群逻辑上的资源分类，用于实现多租户的资源隔离。k8s上所有命名空间对应于containerd的k8s.io命名空间。  1.1 查看集群上命名空间 123456[root@node001 ~]# kubectl get namespaces NAME              STATUS   AGEdefault           Active   18hkube-node-lease   Active   18hkube-public       Active   18hkube-system       Active   18h 1.2 查看指定ns空间资源 12345678910111213141516[root@node001 ~]# kubectl get pod -n kube-system NAME                                       READY   STATUS    RESTARTS   AGEcalico-kube-controllers-6799f5f4b4-jfclq   1/1...</div></div></div></a><a class="pagination-related" href="/20220906/kubernetes-20220906-4-%E4%BA%86%E8%A7%A3etcd/" title="4.了解etcd"><img class="cover" src="/img/yuanshen/avatar/128170_111705817.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-06</div><div class="info-item-2">4.了解etcd</div></div><div class="info-2"><div class="info-item-1">1. 简介 etcd集群是一个分布式系统，使用Raft协议来维护集群内容各个节点状态的一致性。 主机状态Leader,Follower,Candidate 当集群初始化时候，每个节点都是Follower角色 通过心跳与其他节点同步数据 当Follower在一定时间内没有收到来自其他节点的心跳，会将自己角色改变为Candidate，并发起一次选主投票。 配置etcd集群，建议尽可能是奇数个节点。 目前在用的两个大版本v2，v3 v3已键值对的方式来存储数据，k8s从1.5开始使用v3版本etcd。  2. 单节点etcd 2.1 安装etcd 1[root@node001 ~]# yum install etcd -y 2.2 修改配置文件 12345678910111213141516171819202122[root@node001 ~]# vim...</div></div></div></a><a class="pagination-related" href="/20220907/kubernetes-20220907-5-k8s%E5%8D%87%E7%BA%A7/" title="5.k8s升级"><img class="cover" src="/img/yuanshen/avatar/9h4570737p0.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-07</div><div class="info-item-2">5.k8s升级</div></div><div class="info-2"><div class="info-item-1">1. 版本介绍 了解kubernetes版本的命名：x.y.z x—主版本号 y—次版本号 z—补丁号 升级kubernetes的时候，是不能跨版本升级的： 1.y — 1.y+1 不能够 1.y — 1.y+2 2. 更新流程 先更新master再更新worker 1.先更新kubeadm 2.把节点设置drain 3.更新组件 4.更新kubelet、kubectl 5.把节点恢复正常 3. 查看仓库支持的版本 123456789101112131415161718[root@node001 ~]# yum list --showduplicates kubeadm --disableexcludes=kubernetesLoaded plugins: fastestmirrorLoading mirror speeds from cached hostfileInstalled Packageskubeadm.x86_64                                                                        ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">1 主机基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%B8%BB%E6%9C%BA%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 主机名配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Hosts"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Hosts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-CentOS-%E5%85%B3%E9%97%AD-selinux"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 CentOS 关闭 selinux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99-%E5%8F%AF%E9%80%89-%E6%88%96%E8%80%85%E6%94%BE%E8%A1%8C%E7%9B%B8%E5%BA%94%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 关闭防火墙(可选)或者放行相应端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E6%97%B6%E9%97%B4%E3%80%81%E6%97%B6%E5%8C%BA%E3%80%81%E7%B3%BB%E7%BB%9F%E8%AF%AD%E8%A8%80"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 配置主机时间、时区、系统语言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA-DNS-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 配置主机 DNS 服务器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">2 Kernel 调优</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">3 连接数调整</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">4 Docker 安装与配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-Docker-%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 Docker 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1 修改系统源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-Docker-ce-%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.2.</span> <span class="toc-text">4.1.2 Docker-ce 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E9%94%81%E5%AE%9A-Docker-%E7%89%88%E6%9C%AC"><span class="toc-number">4.1.3.</span> <span class="toc-text">4.1.3 锁定 Docker 版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%9C%B0%E5%9D%80"><span class="toc-number">4.1.4.</span> <span class="toc-text">4.2.2 配置镜像加速地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E9%85%8D%E7%BD%AE-insecure-registries%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="toc-number">4.1.5.</span> <span class="toc-text">4.2.3 配置 insecure-registries私有仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E9%85%8D%E7%BD%AE-Docker-%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8"><span class="toc-number">4.1.6.</span> <span class="toc-text">4.2.4 配置 Docker 存储驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97%E9%A9%B1%E5%8A%A8"><span class="toc-number">4.1.7.</span> <span class="toc-text">4.2.5 配置日志驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6-%E5%8F%AF%E9%80%89-%E4%BF%AE%E6%94%B9-Docker0-%E9%BB%98%E8%AE%A4-%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">4.1.8.</span> <span class="toc-text">4.2.6 (可选)修改 Docker0 默认 网络接口 IP 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-7-Ubuntu-Debian-%E7%B3%BB%E7%BB%9F-%EF%BC%8Cdocker-info-%E6%8F%90%E7%A4%BA-WARNING-No-swap-limit-support"><span class="toc-number">4.1.9.</span> <span class="toc-text">4.2.7 Ubuntu\Debian 系统 ，docker info 提示 WARNING: No swap limit support</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By ren_mcc</div><div class="footer_custom_text"><a rel="noopener external nofollow noreferrer noopener" target="_blank" href="https://beian.miit.gov.cn/"> <img class="icp-icon entered loading" alt="ICP" src="/img/icp.png" data-ll-status><span>京ICP备2022001205号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: '',
      owner: '',
      admin: [''],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || 'e796786d935561882aacc6763287e407'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><div class="aplayer no-destroy" data-id="7211977673" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="list" data-preload="none" data-autoplay="false" muted></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/docker/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🐱 docker (8)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/docker-compose/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 docker-compose (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/containerd/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎮 containerd (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/kubernetes/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 kubernetes (27)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/python/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 python (37)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/golang/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 golang (38)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 redis (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://renm.cc/categories/kafka/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 kafka (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://renm.cc/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><!-- hexo injector body_end end --></body></html>